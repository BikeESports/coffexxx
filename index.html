<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CoffeXXX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/webp" href="logocoffexxx.webp">

  <style>
    * { box-sizing:border-box; margin:0; padding:0; }

    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#020617;
      color:#e5e7eb;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header {
      padding:16px 20px;
      text-align:center;
      border-bottom:1px solid rgba(30,64,175,0.5);
    }

    header img.logo {
      width:130px;
      height:auto;
      margin:0 auto 10px;
      mix-blend-mode:lighten;
      display:block;
      -webkit-user-drag:none;
      user-select:none;
    }

    header h1 {
      font-size:1.3rem;
      font-weight:600;
      margin-bottom:4px;
    }

    header p {
      font-size:0.85rem;
      color:rgba(148,163,184,0.95);
    }

    main {
      width:100%;
      max-width:900px;
      margin:0 auto;
      padding:20px 12px 50px;
    }

    .section-title {
      font-size:1.1rem;
      margin-bottom:10px;
      font-weight:600;
      color:#e2e8f0;
    }

    /* GRID DE CONTENIDO */
    .grid {
      margin-top:10px;
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(170px,1fr));
      gap:12px;
    }

    .thumb {
      position:relative;
      width:100%;
      height:240px;
      border-radius:12px;
      overflow:hidden;
      background:#0f172a;
      cursor:pointer;
    }

    .thumb-inner {
      width:100%;
      height:100%;
      background-size:cover;
      background-position:center;
      filter:blur(22px) brightness(0.35);
      transition:0.25s ease;
    }

    .thumb.unlocked .thumb-inner {
      filter:none;
    }

    .thumb::after {
      content:"Contenido desbloqueado ✓";
      position:absolute;
      bottom:6px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(34,197,94,0.85);
      color:#022c22;
      padding:2px 10px;
      border-radius:999px;
      font-size:0.7rem;
      opacity:0;
      pointer-events:none;
      transition:0.25s;
    }

    .thumb.unlocked::after { opacity:1; }

    /* VIDEO */
    .thumb video {
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:12px;
    }

    /* FORMULARIO */
    form {
      margin-top:26px;
      background:#020617;
      border:1px solid rgba(30,64,175,0.65);
      padding:16px;
      border-radius:12px;
    }

    .form-group { margin-bottom:12px; }

    label { display:block; margin-bottom:4px; font-size:0.85rem; }

    input, textarea {
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid rgba(148,163,184,0.85);
      background:#050b18;
      color:#e5e7eb;
      font-size:0.88rem;
      outline:none;
    }

    textarea { height:70px; resize:none; }

    .btn-primary, .btn-secondary {
      padding:10px 14px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      width:100%;
      margin-top:10px;
      font-size:0.9rem;
      font-weight:500;
    }

    .btn-primary { background:#22c55e; color:#022c22; }
    .btn-secondary { background:#0ea5e9; color:#02273b; }

    #aliasBox {
      display:none;
      border:1px solid rgba(94,234,212,0.5);
      padding:10px;
      border-radius:10px;
      background:#042f2e;
      margin-top:12px;
    }

    #formStatus {
      margin-top:10px;
      font-size:0.85rem;
      min-height:20px;
    }

    footer {
      margin-top:auto;
      padding:14px;
      text-align:center;
      font-size:0.8rem;
      color:rgba(148,163,184,0.9);
      border-top:1px solid rgba(30,64,175,0.5);
    }
  </style>
</head>
<body>

<header>
  <img src="logocoffexxx.webp" class="logo" id="coffexLogo">
  <h1>CoffeXXX</h1>
  <p>Contenido exclusivo · Suscripción mensual $80.000 ARS</p>
</header>

<main>

  <h2 class="section-title">Contenido exclusivo (6 fotos + 1 video)</h2>

  <!-- GALERÍA -->
  <div class="grid">

    <!-- FOTO 1 -->
    <div class="thumb" data-type="image" data-hd="foto1.jpg">
      <div class="thumb-inner" style="background-image:url('foto1.jpg')"></div>
    </div>

    <div class="thumb" data-type="image" data-hd="foto2.jpg">
      <div class="thumb-inner" style="background-image:url('foto2.jpg')"></div>
    </div>

    <div class="thumb" data-type="image" data-hd="foto3.jpg">
      <div class="thumb-inner" style="background-image:url('foto3.jpg')"></div>
    </div>

    <div class="thumb" data-type="image" data-hd="foto4.jpg">
      <div class="thumb-inner" style="background-image:url('foto4.jpg')"></div>
    </div>

    <div class="thumb" data-type="image" data-hd="foto5.jpg">
      <div class="thumb-inner" style="background-image:url('foto5.jpg')"></div>
    </div>

    <div class="thumb" data-type="image" data-hd="foto6.jpg">
      <div class="thumb-inner" style="background-image:url('foto6.jpg')"></div>
    </div>

    <!-- VIDEO -->
    <div class="thumb"
         data-type="video"
         data-video="video1.mp4"
         data-poster="foto1.jpg">
      <div class="thumb-inner" style="background-image:url('foto1.jpg')"></div>
    </div>

  </div>

  <!-- FORMULARIO -->
  <h2 class="section-title" style="margin-top:30px;">Solicitar acceso</h2>

  <form id="requestForm">

    <div class="form-group">
      <label>Nombre completo *</label>
      <input id="nombre" type="text" required>
    </div>

    <div class="form-group">
      <label>Contacto (Instagram, WhatsApp, etc.) *</label>
      <input id="contacto" type="text" required>
    </div>

    <div class="form-group">
      <label>Email (opcional)</label>
      <input id="email" type="email">
    </div>

    <div class="form-group">
      <label>Nota para el admin (opcional)</label>
      <textarea id="nota"></textarea>
    </div>

    <div class="form-group" style="margin-top:10px;">
      <label><input type="checkbox" id="acepto"> Confirmo que soy mayor de edad *</label>
    </div>

    <!-- BOTÓN VER ALIAS -->
    <button type="button" class="btn-secondary" onclick="showAlias()">
      Ver alias para pagar
    </button>

    <!-- ALIAS (OCULTO HASTA DAR CLICK) -->
    <div id="aliasBox">
      <p><strong>Alias para pagar:</strong> <span style="color:#5eead4;">agusdente</span></p>
      <p style="font-size:0.8rem; color:#a5f3fc;">
        Este alias pertenece al intermediario.  
        El dinero se envía automáticamente a la creadora Sofi.
      </p>

      <div class="form-group" style="margin-top:10px;">
        <label>Comprobante de pago *</label>
        <input id="comprobante" type="text" placeholder="Ej: CAP-1234" required>
      </div>
    </div>

    <!-- BOTÓN ENVIAR -->
    <button type="submit" class="btn-primary">Enviar solicitud</button>

    <div id="formStatus"></div>

  </form>

</main>

<footer>
  CoffeXXX © Contenido exclusivo · Suscripción mensual
</footer>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDnQKrLuArSTWwg98T5sBCPQuP7yWg5zUc",
    authDomain: "coffexxx-admin.firebaseapp.com",
    projectId: "coffexxx-admin",
    storageBucket: "coffexxx-admin.firebasestorage.app",
    messagingSenderId: "669030910916",
    appId: "1:669030910916:web:e170abf4663aec7bb1f291",
    measurementId: "G-7XR9SB1BGZ"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const STORAGE_KEY = "coffexxx_request_v1";

  let aliasVisible = false;
  let unsubscribeDoc = null;

  function applyUnlockedState() {
    document.querySelectorAll(".thumb").forEach(thumb => {
      thumb.classList.add("unlocked");
      const type = thumb.dataset.type;

      if (type === "image") {
        const hd = thumb.dataset.hd;
        const inner = thumb.querySelector(".thumb-inner");
        if (inner && hd) inner.style.backgroundImage = `url('${hd}')`;
      }

      if (type === "video") {
        const src = thumb.dataset.video;
        const poster = thumb.dataset.poster;
        thumb.innerHTML = `
          <video controls playsinline controlsList="nodownload"
                 poster="${poster || ''}">
            <source src="${src}" type="video/mp4">
          </video>
        `;
      }
    });
  }

  function listenToRequest(id) {
    if (!id) return;
    if (unsubscribeDoc) unsubscribeDoc();

    unsubscribeDoc = db.collection("suscripciones").doc(id)
      .onSnapshot(doc => {
        if (!doc.exists) return;
        const data = doc.data();
        if (data.desbloqueado) {
          applyUnlockedState();
          const status = document.getElementById("formStatus");
          status.textContent = "Suscripción aprobada. Contenido desbloqueado ✓";
          status.style.color = "#4ade80";
        }
      });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const existing = localStorage.getItem(STORAGE_KEY);
    if (existing) listenToRequest(existing);
  });

  function showAlias() {
    const nombre = document.getElementById("nombre").value.trim();
    const contacto = document.getElementById("contacto").value.trim();
    const acepto = document.getElementById("acepto").checked;

    const status = document.getElementById("formStatus");

    if (!nombre || !contacto || !acepto) {
      status.textContent = "Completá Nombre, Contacto y tildá la casilla de mayor de edad.";
      status.style.color = "#f97373";
      return;
    }

    document.getElementById("aliasBox").style.display = "block";
    aliasVisible = true;

    status.textContent = "Alias mostrado. Realizá el pago y enviá el comprobante.";
    status.style.color = "#5eead4";
  }

  document.getElementById("requestForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const nombre = document.getElementById("nombre").value.trim();
    const contacto = document.getElementById("contacto").value.trim();
    const email = document.getElementById("email").value.trim();
    const nota = document.getElementById("nota").value.trim();
    const comprobante = document.getElementById("comprobante").value.trim();
    const acepto = document.getElementById("acepto").checked;

    const status = document.getElementById("formStatus");

    if (!aliasVisible) {
      status.textContent = "Primero tocá 'Ver alias para pagar'.";
      status.style.color = "#f97373";
      return;
    }

    if (!nombre || !contacto || !comprobante || !acepto) {
      status.textContent = "Completá los datos obligatorios y el comprobante.";
      status.style.color = "#f97373";
      return;
    }

    status.textContent = "Enviando solicitud...";
    status.style.color = "#e5e7eb";

    try {
      const ref = await db.collection("suscripciones").add({
        nombre,
        contacto,
        email: email || null,
        nota: nota || null,
        comprobante,
        creado: firebase.firestore.FieldValue.serverTimestamp(),
        origen: "CoffeXXX",
        monto: 80000,
        moneda: "ARS",
        desbloqueado: false
      });

      localStorage.setItem(STORAGE_KEY, ref.id);
      listenToRequest(ref.id);

      status.textContent = "Solicitud enviada. Se desbloquea cuando el admin la apruebe.";
      status.style.color = "#4ade80";

    } catch(err) {
      console.error(err);
      status.textContent = "Error al enviar la solicitud.";
      status.style.color = "#f97373";
    }
  });
</script>

</body>
</html>
